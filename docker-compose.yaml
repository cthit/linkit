version: "2"
services:
    backend:
        build:
            context: ./backend
            dockerfile: dev.Dockerfile
        image: linkit_backend:dev
        ports:
            - 4000:4000
            - 4001:4001
        volumes:
            - ./backend:/usr/src/app
        environment:
            ADMINS: admin
            REDIRECT_URL: "localhost:3001"
        depends_on:
            - redis
            - gamma-backend
    frontend:
        build:
            context: ./frontend
            dockerfile: dev.Dockerfile
        image: linkit_frontend:dev
        ports:
            - 3001:3000
        volumes:
            - ./frontend/src:/usr/src/app/src
            - ./frontend/public:/usr/src/app/public
        depends_on:
            - backend
    db:
        image: postgres:12
        restart: always
        environment:
            POSTGRES_DB: bookit
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: example
        ports:
            - 5432:5432
    redis:
        image: redis:5.0.8
        ports:
            - 6379:6379
    gamma-backend:
        image: cthit/gamma-backend
        environment:
            DB_HOST: gamma-db
            SERVER_PORT: 8081
            FRONTEND_CLIENT_ID: 7hAdUEtMo4MgFnA7ZoZ41ohTe1NNRoJmjL67Gf0NIrrBnauyhc
            FRONTEND_CLIENT_SECRET: secret
            FRONTEND_REDIRECT_URI: http://localhost:3000/login
            SUCCESSFUL_LOGIN: http://localhost:3000
            DEFAULT_CLIENT_NAME: name
            DEFAULT_CLIENT_ID: id
            DEFAULT_CLIENT_SECRET: secret
            DEFAULT_REDIRECT_URI: http://localhost:3001/auth/account/callback
            DEFAULT_API_KEY: key
            CORS_ALLOWED_ORIGIN: "*"
            IS_MOCKING_CLIENT: "true"
            ADMIN_PASSWORD: password
            ROOT_DEBUG_LEVEL: info
            REDIS_PASSWORD: ""
            REDIS_HOST: "redis"
            COOKIE_DOMAIN: "localhost"

        ports:
            - 8081:8081
            - 9090:9090
        depends_on:
            - gamma-db
            - redis
    gamma-frontend:
        image: cthit/gamma-frontend:development
        ports:
            - 3000:3000
    gamma-db:
        image: postgres:10
        environment:
            POSTGRES_USER: user
            POSTGRES_PASSWORD: password
            POSTGRES_DB: postgres
        restart: always
    adminer:
        image: adminer
        restart: always
        ports:
            - 8080:8080
